pipeline {
    agent {
        node {
            label '#node'
        }
    }
    stages {
        stage('Deploy artifact') {
            steps {
                node('#artifactory'){
                   sh 'cp /home/ubuntu/jenkins/workspace/build/spring_petclinic/target/*.jar .'
                   stash name: "artifact", includes: "*.jar"
                }
            }
        }
        stage('Start application') {
            steps {
                node('#Production'){
                    sh 'sudo systemctl stop petclinic.service'
                    unstash name: "artifact"
                    sh 'sudo systemctl start petclinic.service'
                }
            }
        }
    }
}
